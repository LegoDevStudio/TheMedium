--Config
-- Protocol
local a="control_music"
term.setCursorPos(1,1)term.clear()rednet.open("back")os.loadAPI("json")term.setTextColor(colors.purple)print("Music Venue Controls - V2")print("1 - Screen Controls")print("2 - Pyrotechnics")local b=read()if b=="1"then term.setCursorPos(1,1)term.clear()print("Screen Controls")print("1 - Set Screen URL")print("2 - Idle screen")print("3 - Turn screen off")local c=read()if c=="1"then term.setCursorPos(1,1)term.clear()print("Please enter URL")local d=read()rednet.broadcast("{\"op\":0,\"data\":{\"url\":\""..d.."\"}}",a)elseif c=="2"then rednet.broadcast("{\"op\":2,\"data\":{}}",a)elseif c=="3"then rednet.broadcast("{\"op\":1,\"data\":{}}",a)else print("Sorry, "..c.." was not an option.")sleep(2)os.reboot()end elseif b=="2"then term.setCursorPos(1,1)term.clear()print("Pyrotechnics Controls")print("1 - Fireworks")print("2 - Smoke")local c=read()if c=="1"then term.setCursorPos(1,1)term.clear()print("Please enter amount of fireworks to fire.")local e=tonumber(read())if type(e)=="number"then rednet.broadcast("{\"op\":3,\"data\":{\"pulses\":"..e.."}}",a)else print("Amount must be a number.")sleep(2)os.reboot()end elseif c=="2"then term.setCursorPos(1,1)term.clear()print("Please enter amount of pulses to fire.")local e=tonumber(read())if type(e)=="number"then rednet.broadcast("{\"op\":4,\"data\":{\"pulses\":"..e.."}}",a)else print("Amount must be a number.")sleep(2)os.reboot()end else print("Sorry, "..c.." was not an option.")sleep(2)os.reboot()end end;local f,g,h=rednet.receive()local i=json.decode(g)if i.op==1 then if i.data==nil or i.data.code==nil then else if i.data.code=="INVALID_DATA"then term.setTextColor(colors.red)print("Invalid data was sent to the server by this device.")print("Possible counterfiet device detected. Wiping data...")shell.run("delete json")shell.run("delete startup.lua")shell.run("delete server.lua")print("Data has been wiped from this device. Shutting down in 5 seconds.")sleep(5)os.shutdown()elseif i.data.code=="INVALID_OP"then term.setTextColor(colors.red)print("Invalid OPCODE was sent to the server by this device.")print("Possible counterfiet device detected. Wiping data...")shell.run("delete json")shell.run("delete startup.lua")shell.run("delete server.lua")print("Data has been wiped from this device. Shutting down in 5 seconds.")sleep(5)os.shutdown()end end elseif i.op==0 then if i.data==nil or i.data.code==nil then else if i.data.code=="SUCCESS"then term.setTextColor(colors.green)print("Success!")sleep(2)os.reboot()end end end
